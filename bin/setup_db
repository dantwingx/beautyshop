#!/bin/bash
set -e

echo "ğŸ”§ Database Setup Script"
echo "======================="

# Check if we're in production with a database
if [ -z "$DATABASE_URL" ]; then
  echo "âŒ No DATABASE_URL found. Are you connected to Railway?"
  exit 1
fi

echo "âœ… DATABASE_URL found"

# Create database (if needed)
echo "ğŸ“¦ Creating database structure..."
bundle exec rails db:create 2>/dev/null || echo "Database already exists"

# Run migrations
echo "ğŸ—ï¸  Running migrations..."
bundle exec rails db:migrate

# Check migration status
echo "ğŸ“Š Migration status:"
bundle exec rails db:migrate:status

# Seed database
echo "ğŸŒ± Seeding database..."
bundle exec rails db:seed

echo "âœ… Database setup complete!"
echo "ğŸ“Š Table count:"
bundle exec rails runner "puts ActiveRecord::Base.connection.tables.count"